<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BLACKPIGEONS Archive </title>
<style>
  :root {
    --bg: #000;
    --panel: #111;
    --text: #ccc;
    --accent: #ff3b3b; /* red for errors */
    --muted: #888;
    --mono: "Lucida Console", Monaco, monospace;
    --glass: rgba(255,255,255,0.03);
  }
  html, body { margin:0; height:100%; background: var(--bg); color: var(--text); font-family: var(--mono); }
  .wrap { max-width:1100px; margin:24px auto; padding:16px; background: var(--panel); border-radius:8px; }
  header { display:flex; align-items:center; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
  .logo { font-weight:700; font-size:20px; color:var(--text); }
  .controls { margin-left:auto; display:flex; gap:8px; flex-wrap:wrap; }
  input.search { background:var(--glass); border:1px solid #222; color:var(--text); padding:6px 10px; border-radius:6px; width:240px; }
  table { width:100%; border-collapse:collapse; font-size:14px; }
  thead th { text-align:left; padding:10px 8px; border-bottom:1px dashed #222; color:var(--muted); }
  tbody tr { transition: background .1s; }
  tbody tr:hover { background: rgba(255,255,255,0.05); }
  td { padding:10px 8px; border-bottom:1px dashed #222; }
  .title { font-weight:600; }
  .meta { color: var(--muted); font-size:12px; }
  .tag { display:inline-block; padding:2px 6px; border-radius:6px; background:#222; margin-right:4px; font-size:11px; }
  .actions a { padding:4px 6px; border-radius:4px; color:var(--text); text-decoration:none; border:1px solid #222; font-size:12px; margin-right:4px; }
  .error { color: var(--accent); font-weight:700; }
  footer { color:var(--muted); font-size:12px; margin-top:12px; padding-top:12px; border-top:1px solid #222; display:flex; justify-content:space-between; }
  /* modal */
  .modal { position:fixed; inset:0; background: rgba(0,0,0,0.85); display:none; align-items:center; justify-content:center; padding:20px; z-index:999; }
  .card { width:100%; max-width:1000px; background:var(--panel); border-radius:8px; overflow:hidden; }
  .card .head { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #222; }
  .viewer { height:70vh; width:100%; border:0; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">BLACKPIGEONS Archive</div>
    <div class="controls">
      <input id="q" class="search" placeholder="Search..." />
      <button id="refresh">Reload</button>
    </div>
  </header>
  <main>
    <table id="list">
      <thead>
        <tr><th>Title</th><th>Size</th><th>Type</th><th>Date</th><th>Actions</th></tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </main>
  <footer>
    <div>Only legal / public-domain content</div>
    <div>Monochrome theme with red accent for errors</div>
  </footer>
</div>

<div id="modal" class="modal" role="dialog" aria-hidden="true">
  <div class="card">
    <div class="head">
      <div id="modalTitle">Viewer</div>
      <div style="display:flex;gap:8px;align-items:center">
        <a id="rawLink" target="_blank">Open raw</a>
        <button id="close">Close</button>
      </div>
    </div>
    <div id="modalBody"></div>
  </div>
</div>

<script>
const DATA_SRC = './files.json';
const $ = sel => document.querySelector(sel);
const rows = $('#rows');
const q = $('#q');
const modal = $('#modal');
const modalBody = $('#modalBody');
const modalTitle = $('#modalTitle');
const rawLink = $('#rawLink');

let items = [];

async function loadData(){
  try{
    const r = await fetch(DATA_SRC,{cache:'no-store'});
    if(!r.ok) throw 'no json';
    items = await r.json();
  }catch(e){
    console.warn('Could not load files.json — using sample', e);
    items = [
      {"id":"sample1","title":"Sample PDF","size":"1MB","type":"pdf","date":"2023-01-01","url":"https://archive.org/download/oliver_twist_0810_librivox/oliver_twist_0810.pdf"},
      {"id":"sample2","title":"Broken Video","size":"0MB","type":"video","date":"2023-01-02","url":"https://archive.org/download/missingfile.mp4","error":true}
    ];
  }
  render();
}

function render(){
  const query = (q.value||'').toLowerCase();
  rows.innerHTML = '';
  items.forEach(it=>{
    if(query && !(it.title.toLowerCase().includes(query))) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="${it.error?'error':''}">${it.title}</td>
      <td>${it.size||'—'}</td>
      <td>${it.type||'—'}</td>
      <td>${it.date||'—'}</td>
      <td>
        <a href="${it.url}" target="_blank" class="${it.error?'error':''}">Download</a>
        <a href="#" data-id="${it.id}" class="view ${it.error?'error':''}">View</a>
      </td>
    `;
    rows.appendChild(tr);
  });

  $$('.view').forEach(a=>{
    a.addEventListener('click',e=>{
      e.preventDefault();
      const id = a.getAttribute('data-id');
      const it = items.find(x=>x.id===id);
      if(it) openViewer(it);
    });
  });
}

function openViewer(it){
  modalTitle.textContent = it.title;
  rawLink.href = it.url;
  modalBody.innerHTML = '';
  if(it.type==='pdf') {
    const iframe = document.createElement('iframe');
    iframe.src = it.url;
    iframe.className='viewer';
    modalBody.appendChild(iframe);
  } else if(it.type==='video'){
    const v = document.createElement('video');
    v.controls=true; v.className='viewer';
    const src = document.createElement('source');
    src.src = it.url; src.type='video/mp4';
    v.appendChild(src);
    modalBody.appendChild(v);
  } else {
    modalBody.innerHTML=`<div style="padding:18px;color:var(--text)">No viewer. <a href="${it.url}" target="_blank">Open raw</a></div>`;
  }
  modal.style.display='flex';
}

$('#close').addEventListener('click',()=>{modal.style.display='none'; modalBody.innerHTML='';});
modal.addEventListener('click',e=>{if(e.target===modal) modal.style.display='none';});

q.addEventListener('input',render);
$('#refresh').addEventListener('click',loadData);

loadData();
</script>
</body>
</html>
