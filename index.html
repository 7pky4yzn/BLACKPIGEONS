<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BLACKPIGEONS — Archive UI (Monochrome)</title>
<style>
  :root{
    --bg:#111213;
    --panel:#191a1c;
    --accent:#e7e7e7;
    --muted:#bdbdbd;
    --danger:#e15a5a;
    --danger-bg:rgba(225,90,90,0.12);
    --danger-light:#ffb3b3;
    --glass: rgba(255,255,255,0.025);
    --mono: "Lucida Console", Monaco, monospace;
    --sans: "Helvetica Neue", Helvetica, Arial, sans-serif;
    --border:#232323;
    --shadow: rgba(0,0,0,0.10);
    --table-row:#18191a;
    --tag-bg:rgba(255,255,255,0.03);
    --modal-bg:rgba(0,0,0,0.82);
  }
  html,body{
    height:100%;
    margin:0;
    background:linear-gradient(180deg,#111213 0%,var(--bg) 60%);
    color:var(--accent);
    font-family: var(--sans);
    font-size:15px;
    letter-spacing:0.01em;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  .wrap{
    max-width:1040px;
    margin:32px auto;
    padding:32px 24px 28px 24px;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.01));
    border-radius:12px;
    box-shadow:0 8px 32px var(--shadow);
    border:1.5px solid var(--border);
  }
  header{
    display:flex;
    gap:20px;
    align-items:center;
    margin-bottom:18px;
    padding-bottom:2px;
    border-bottom:1px solid var(--border);
  }
  .logo{
    font-family:var(--mono);
    font-weight:700;
    font-size:22px;
    color:var(--accent);
    display:flex;
    align-items:center;
    gap:10px;
    letter-spacing:0.03em;
    user-select:none;
  }
  .logo .dot{
    width:12px;
    height:12px;
    background:var(--accent);
    border-radius:3px;
    box-shadow:0 0 8px var(--accent);
    opacity:0.75;
  }
  .sub{
    color:var(--muted);
    font-size:13px;
    font-family:var(--mono);
    margin-top:2px;
    letter-spacing:0.01em;
  }
  .controls{
    margin-left:auto;
    display:flex;
    gap:10px;
    align-items:center;
  }
  input.search{
    background:var(--glass);
    border:1.5px solid var(--border);
    color:var(--accent);
    padding:10px 14px;
    border-radius:7px;
    outline:none;
    width:310px;
    font-family:var(--mono);
    font-size:15px;
    transition:border-color .14s;
  }
  input.search:focus{
    border-color:var(--accent);
    background:rgba(255,255,255,0.03);
  }
  select{
    background:transparent;
    border:1.5px solid var(--border);
    color:var(--muted);
    padding:10px 10px;
    border-radius:7px;
    font-family:var(--mono);
    font-size:15px;
    transition:border-color .13s;
    cursor:pointer;
  }
  select:focus{
    border-color:var(--accent);
    outline:none;
  }
  table{
    width:100%;
    border-collapse:collapse;
    margin-top:16px;
    font-size:15px;
    font-family:var(--mono);
    background:transparent;
  }
  thead th{
    color:var(--muted);
    text-align:left;
    padding:12px 8px 8px 8px;
    border-bottom:1.5px solid var(--border);
    font-weight:700;
    letter-spacing:0.04em;
    font-size:15px;
  }
  tbody tr{
    transition:background .12s;
    background:transparent;
  }
  tbody tr:hover{
    background:var(--table-row);
  }
  td{
    padding:13px 8px 13px 8px;
    border-bottom:1px solid var(--border);
    vertical-align:top;
  }
  .title{
    color:var(--accent);
    font-family:var(--mono);
    font-weight:600;
    letter-spacing:0.01em;
    font-size:15px;
    transition: color .16s;
  }
  .title.incomplete {
    color: var(--danger-light);
    text-shadow: 0 0 2px var(--danger-bg);
  }
  .meta{
    color:var(--muted);
    font-size:12px;
    font-family:var(--mono);
    margin-top:2px;
    letter-spacing:0.02em;
  }
  .tag{
    display:inline-block;
    padding:3px 10px;
    border-radius:999px;
    background:var(--tag-bg);
    color:var(--muted);
    font-size:12px;
    font-family:var(--mono);
    margin-right:5px;
    margin-bottom:1px;
    letter-spacing:0.04em;
  }
  .actions {
    display: flex;
    flex-direction: row;
    gap: 10px;
    align-items: center;
  }
  .actions a,
  .actions .disabled-btn{
    background:var(--tag-bg);
    padding:7px 13px;
    border-radius:7px;
    color:var(--muted);
    text-decoration:none;
    border:1px solid var(--border);
    font-family:var(--mono);
    font-size:13px;
    transition:background .13s, color .13s;
    display:inline-block;
    margin: 0 !important;
    pointer-events: auto;
    opacity: 1;
  }
  .actions a:hover{
    background:var(--accent);
    color:var(--bg);
    border-color:var(--accent);
  }
  .actions .disabled-btn {
    color: var(--danger-light);
    border-color: var(--danger-bg);
    background: var(--danger-bg);
    opacity: 0.6;
    cursor: not-allowed;
    pointer-events: none;
    text-decoration:line-through;
  }
  .seed{color:#bdbdbd;font-weight:700}
  .leech{color:#bababa;font-weight:700}
  footer{
    color:var(--muted);
    font-size:13px;
    margin-top:16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding-top:13px;
    border-top:1px solid var(--border);
    font-family:var(--mono);
    letter-spacing:0.01em;
  }
  .badge{
    padding:8px 12px;
    border-radius:7px;
    background:var(--tag-bg);
    font-size:13px;
    color:var(--muted);
    font-family:var(--mono);
    margin-bottom:1px;
  }
  /* modal */
  .modal{
    position:fixed;
    inset:0;
    background:var(--modal-bg);
    display:none;
    align-items:center;
    justify-content:center;
    padding:32px 10px;
    z-index:999;
  }
  .card{
    width:100%;
    max-width:1040px;
    background:var(--panel);
    border-radius:10px;
    box-shadow:0 12px 48px var(--shadow);
    overflow:hidden;
    border:1.5px solid var(--border);
  }
  .card .head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 19px;
    border-bottom:1px solid var(--border);
    background:var(--panel);
  }
  .viewer{
    height:70vh;
    border:0;
    width:100%;
    background:#191a1b;
  }
  @media (max-width:720px){
    .wrap{padding:15px 2vw;}
    input.search{width:100%; min-width:0;}
    header{flex-direction:column;align-items:flex-start;gap:10px;}
    .controls{width:100%;flex-wrap:wrap;}
    table{font-size:13px;}
    thead th, td{font-size:13px;}
    .card{max-width:99vw;}
    .actions {flex-direction: column; gap: 6px;}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo"><span class="dot"></span> BLACKPIGEONS</div>
    <div>
      <div class="sub">.</div>
    </div>
    <div class="controls">
      <input id="q" class="search" placeholder="Search title, author, tag..." />
      <select id="filterType" title="Filter type">
        <option value="">All types</option>
        <option value="pdf">PDF</option>
        <option value="video">Video</option>
        <option value="zip">Archive</option>
      </select>
    </div>
  </header>

  <main>
    <table id="list">
      <thead>
        <tr>
          <th style="width:52%">Title</th>
          <th style="width:18%">Size</th>
          <th style="width:10%">Type</th>
          <th style="width:10%">Date</th>
          <th style="width:10%">Actions</th>
        </tr>
      </thead>
      <tbody id="rows">
        <!-- rows injected -->
      </tbody>
    </table>
  </main>

  <footer>
    <div class="badge">.</div>
    <div class="sub">Built by 7pky4yzn</div>
  </footer>
</div>

<!-- modal viewer -->
<div id="modal" class="modal" role="dialog" aria-hidden="true">
  <div class="card" role="document">
    <div class="head">
      <div id="modalTitle" style="color:var(--accent);font-weight:700;font-family:var(--mono)">Viewer</div>
      <div style="display:flex;gap:10px;align-items:center">
        <a id="rawLink" class="actions" target="_blank" rel="noopener" style="margin-right:8px;color:var(--muted);text-decoration:none">Open raw</a>
        <button id="close" class="small">Close</button>
      </div>
    </div>
    <div id="modalBody" style="background:#191a1b;">
      <!-- iframe / video injected -->
    </div>
  </div>
</div>

<script>
const DATA_SRC = './files.json'; // change if needed

const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);
const rows = $('#rows');
const q = $('#q');
const filterType = $('#filterType');
const modal = $('#modal');
const modalBody = $('#modalBody');
const modalTitle = $('#modalTitle');
const rawLink = $('#rawLink');

let items = [];

// fallback sample if files.json missing
const sample = [
  {"id":"sample-pdf","title":"Sample Public Domain Book","author":"Various","size":"2.1 MB","type":"pdf","date":"2020-05-12","url":"https://archive.org/download/oliver_twist_0810_librivox/oliver_twist_0810.pdf","desc":"Public domain sample"},
  {"id":"sample-video","title":"Sample Lecture","author":"Nobody","size":"120 MB","type":"video","date":"2021-07-01","url":"https://archive.org/download/BigBuckBunny_328/BigBuckBunny_512kb.mp4","desc":"Demo video (public domain style)"},
  {"id":"broken-pdf","title":"Corrupted PDF File","author":"Unknown","size":"3 MB","type":"pdf","date":"2025-09-01","url":"https://example.com/badfile.pdf","desc":"File failed to upload","status":"error"}
];

async function loadData(){
  try {
    const r = await fetch(DATA_SRC, {cache:'no-store'});
    if(!r.ok) throw new Error('no json');
    items = await r.json();
    if(!Array.isArray(items) || items.length===0) throw 'empty';
  } catch(e){
    console.warn('Could not load files.json — using sample data. Error:', e);
    items = sample;
  }
  render();
}

function render(){
  const query = (q.value || '').trim().toLowerCase();
  const typeF = filterType.value;
  // simple sort: newest first by date if present
  const sorted = items.slice().sort((a,b)=>{
    if(a.date && b.date) return new Date(b.date) - new Date(a.date);
    return (a.title||'').localeCompare(b.title||'');
  });

  rows.innerHTML = '';
  for(const it of sorted){
    if(typeF && it.type !== typeF) continue;
    if(query){
      const hay = (it.title + ' ' + (it.author||'') + ' ' + (it.desc||'') + ' ' + (it.tags||'')).toLowerCase();
      if(!hay.includes(query)) continue;
    }
    const status = (it.status || 'ok').toLowerCase();
    const isIncomplete = status === 'error' || status === 'incomplete';
    const titleClass = isIncomplete ? 'title incomplete' : 'title';
    let actionsHtml;
    if(isIncomplete){
      actionsHtml = `
        <span class="disabled-btn">Download</span>
        <span class="disabled-btn">View</span>
      `;
    }else{
      actionsHtml = `
        <a href="${escapeHtml(it.url)}" target="_blank" rel="noopener">Download</a>
        <a href="#" data-id="${escapeHtml(it.id)}" class="view">View</a>
      `;
    }
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>
        <div class="${titleClass}">${escapeHtml(it.title)}</div>
        <div class="meta">${escapeHtml(it.author || '')} • <span class="tag">${escapeHtml(it.tags || it.type || '')}</span> ${escapeHtml(it.desc || '')}</div>
      </td>
      <td>${escapeHtml(it.size || '—')}</td>
      <td>${escapeHtml((it.type||'').toUpperCase())}</td>
      <td>${escapeHtml(it.date || '—')}</td>
      <td class="actions">
        ${actionsHtml}
      </td>
    `;
    rows.appendChild(tr);
  }

  // attach view handlers (only for enabled)
  $$('.view').forEach(a=>{
    a.addEventListener('click', e=>{
      e.preventDefault();
      const id = a.getAttribute('data-id');
      const it = items.find(x=>x.id===id);
      if(it) openViewer(it);
    });
  });
}

function openViewer(it){
  modalTitle.textContent = it.title + ' — ' + (it.author||'');
  rawLink.href = it.url;
  rawLink.textContent = 'Open raw';
  modalBody.innerHTML = '';

  if(it.type === 'pdf'){
    // show PDF via iframe, remove toolbars if possible
    let pdfUrl = it.url;
    if(pdfUrl.indexOf('#') === -1){
      pdfUrl += '#toolbar=0&navpanes=0&scrollbar=0&view=FitH';
    }else{
      pdfUrl += '&toolbar=0&navpanes=0&scrollbar=0&view=FitH';
    }
    const ifr = document.createElement('iframe');
    ifr.src = pdfUrl;
    ifr.className = 'viewer';
    ifr.setAttribute('allowfullscreen','');
    ifr.setAttribute('title','PDF viewer');
    modalBody.appendChild(ifr);
  } else if(it.type === 'video'){
    // use HTML5 video
    const v = document.createElement('video');
    v.className = 'viewer';
    v.controls = true;
    const src = document.createElement('source');
    src.src = it.url;
    src.type = 'video/mp4';
    v.appendChild(src);
    modalBody.appendChild(v);
  } else {
    // show a simple download link
    modalBody.innerHTML = `<div style="padding:18px;color:var(--muted);font-family:var(--mono)">No inline viewer for this file type. <a href="${it.url}" target="_blank" rel="noopener">Open raw</a></div>`;
  }

  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden','false');
}

$('#close').addEventListener('click',()=>closeModal());
modal.addEventListener('click', e => { if(e.target===modal) closeModal(); });
function closeModal(){
  modal.style.display = 'none';
  modalBody.innerHTML = '';
  modal.setAttribute('aria-hidden','true');
}

q.addEventListener('input', render);
filterType.addEventListener('change', render);

function escapeHtml(s){
  if(!s) return '';
  return String(s).replace(/[&<>"']/g, function(m){
    return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
  });
}

loadData();
</script>
</body>
</html>