<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<title>BLACKPIGEONS — Archive UI (Purplish Veena Theme, Optimised, No Errors)</title>
<style id="theme-style">
  :root {
    /* Custom Veena/FL Studio inspired purples and gradients */
    --bg: #161024;
    --panel: #1e1533;
    --accent: #f6eaff;
    --muted: #b4a6cc;
    --danger: #a62424;
    --danger-light: #e04a7e;
    --glass: rgba(160,120,220,0.07);
    --mono: 'JetBrains Mono', 'Fira Mono', 'Menlo', 'Consolas', 'Liberation Mono', 'DejaVu Sans Mono', 'Lucida Console', 'Monaco', 'monospace';
    --shadow: 0 6px 40px #2c0c4a50, 0 1.5px 0 #29193b;
    --border: #2d2241;
    --table-row: #231832;
    --tag-bg: rgba(146, 104, 255, 0.13);
    --modal-bg: rgba(28,18,38,0.98);
    --card-glass: #22163c;
    --input-bg: #22163c;
    --input-border: #422c5c;
    --action-bg: #231e39;
    --action-hover: #b993f7;
    --action-hover-text: #2e1942;
    --radius: 12px;
    --gap: 18px;
    --pad-main: clamp(10px, 4vw, 34px);
    --pad-table-cell: clamp(5px, 2vw, 13px);
    --pad-header: 20px;
    --pad-footer: 20px;
    --badge-pad: 8px 14px;
    --max-width: 1100px;
    --min-font-size: 13px;
    --max-font-size: 16px;
    --gradient: linear-gradient(90deg, #281c4b 0%, #35295b 100%);
  }
  html,body {
    min-height:100%;
    margin:0;
    background: var(--bg);
    color: var(--accent);
    font-family: var(--mono);
    font-size:clamp(var(--min-font-size),2.8vw,var(--max-font-size));
    letter-spacing:0.01em;
    transition: background .35s, color .18s;
    -webkit-tap-highlight-color: transparent;
    overscroll-behavior-y: none;
    touch-action: manipulation;
  }
  body {
    background: var(--gradient), var(--bg);
    background-attachment: fixed;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .wrap {
    max-width:var(--max-width);
    margin:4vw auto 3vw auto;
    padding:var(--pad-main);
    background: var(--panel);
    border-radius:var(--radius);
    box-shadow: var(--shadow);
    border:1.8px solid var(--border);
    transition: background .35s, box-shadow .18s, border-color .2s;
    flex: 1 0 auto;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }
  header {
    display:flex;
    flex-wrap:wrap;
    gap:var(--gap);
    align-items:flex-end;
    margin-bottom:var(--gap);
    padding-bottom:var(--pad-header);
    border-bottom:1px solid var(--border);
    background: transparent;
  }
  .logo {
    font-family:var(--mono);
    font-weight:700;
    font-size:clamp(14px,4vw,25px);
    color:var(--accent);
    display:flex;
    align-items:center;
    gap:10px;
    letter-spacing:0.04em;
    user-select:none;
    padding-bottom: 2px;
    word-break: break-word;
    text-shadow: 0 1px 10px #9a5fff33;
  }
  .logo .dot {
    width:clamp(8px,2vw,13px);
    height:clamp(8px,2vw,13px);
    background:linear-gradient(135deg, #c678fa 50%, #b993f7 100%);
    border-radius:3px;
    box-shadow:0 0 10px #c678fa99;
    opacity: 0.95;
    margin-right:2px;
    flex-shrink: 0;
  }
  .sub {
    color:var(--muted);
    font-size:clamp(11px,2vw,13px);
    font-family:var(--mono);
    margin-left: 2px;
    margin-bottom: 3px;
    word-break: break-word;
  }
  .controls {
    margin-left:auto;
    display:flex;
    gap:clamp(6px,2vw,13px);
    align-items:center;
    flex-wrap:wrap;
    width:100%;
    max-width: 100vw;
  }
  input.search, select {
    background:var(--input-bg);
    border:1.6px solid var(--input-border);
    color:var(--accent);
    padding:clamp(7px,2vw,11px) clamp(10px,3vw,17px);
    border-radius:8px;
    outline:none;
    font-family:var(--mono);
    font-size:clamp(13px,2.5vw,16px);
    transition:border-color .13s, background .13s;
    max-width:100vw;
    box-sizing: border-box;
  }
  input.search { width:clamp(120px,60vw,270px); }
  select { min-width:100px; }
  input.search:focus, select:focus {
    border-color:var(--action-hover);
    background:var(--glass);
  }
  main {
    margin-top: var(--gap);
    margin-bottom: var(--gap);
    width:100%;
    overflow-x:auto;
    flex: 1 1 auto;
    background: transparent;
  }
  table {
    width:100%;
    border-collapse:separate;
    border-spacing: 0;
    margin-top:0;
    font-size:inherit;
    font-family:var(--mono);
    background:transparent;
    box-shadow: 0 2px 18px #7b4aad22;
    border-radius:var(--radius);
    overflow-x: auto;
    word-break:break-word;
    table-layout: auto;
  }
  thead th, td {
    padding:var(--pad-table-cell) clamp(5px,1vw,12px);
    min-width:60px;
    max-width:320px;
    word-break:break-word;
  }
  thead th {
    color:var(--muted);
    text-align:left;
    border-bottom:1.6px solid var(--border);
    font-weight:700;
    background:transparent;
    font-size:clamp(12px,2vw,15px);
    font-family:var(--mono);
    letter-spacing: 0.01em;
    white-space: nowrap;
  }
  tbody tr {
    transition:background .13s;
    background:transparent;
  }
  tbody tr:hover {
    background:var(--table-row);
  }
  td {
    border-bottom:1px solid var(--border);
    vertical-align:middle;
    background:transparent;
    font-family:var(--mono);
    font-size:clamp(11px,2vw,15px);
  }
  .title {
    color:var(--accent);
    font-weight:700;
    font-family:var(--mono);
    font-size:clamp(13px,2.6vw,17px);
    margin-bottom: 2px;
    letter-spacing: 0.01em;
    line-height: 1.22;
    word-break:break-word;
    max-width: 99vw;
    text-shadow: 0 1px 12px #c678fa29;
  }
  .title.incomplete {color:var(--danger-light);}
  .meta {
    color:var(--muted);
    font-size:clamp(10px,1.8vw,13px);
    font-family:var(--mono);
    margin-top: 2px;
    margin-bottom: 0;
    line-height: 1.45;
    word-break:break-word;
    max-width: 99vw;
  }
  .tag {
    display:inline-block;
    padding:clamp(2px,1vw,3px) clamp(7px,2vw,13px);
    border-radius:999px;
    background:var(--tag-bg);
    color:var(--muted);
    font-size:clamp(10px,1.7vw,12px);
    margin-right:9px;
    font-family:var(--mono);
    margin-bottom: 1px;
    word-break: break-word;
    box-shadow: 0 0 2px #a278ff44;
  }
  .actions {
    display: flex;
    flex-direction: row;
    gap: clamp(8px, 2vw, 16px); /* Increased gap for better spacing */
    align-items: center;
    justify-content: flex-start;
    height: 100%;
    padding: 0;
    margin: 0;
    flex-wrap: nowrap;
  }
  .actions a,
  .actions .disabled-btn {
    background:var(--action-bg);
    padding:clamp(7px,1.5vw,12px) clamp(16px,2vw,22px);
    border-radius:7px;
    color:var(--muted);
    text-decoration:none;
    border:1.6px solid var(--input-border);
    margin: 0 !important;
    display: inline-block;
    vertical-align: middle;
    box-sizing: border-box;
    font-family:var(--mono);
    font-size:clamp(12px,2vw,15px);
    min-width: 84px;
    text-align: center;
    transition: background .13s, color .13s, border-color .13s;
    font-weight: 700;
    letter-spacing: 0.01em;
    word-break: break-word;
    background: linear-gradient(90deg, #2b2450 0%, #2d1e4e 100%);
    border: 1.5px solid #393052;
    box-shadow: 0 1px 4px #a278ff22;
  }
  .actions a:hover{
    background:var(--action-hover);
    color:var(--action-hover-text);
    border-color:#c678fa;
  }
  .actions .disabled-btn {
    color: var(--danger-light);
    border-color: var(--danger);
    background: #37162e;
    opacity: 0.8;
    cursor: not-allowed;
    pointer-events: none;
    text-decoration:line-through;
  }
  .actions a:first-child {margin-right:0;}
  @media (max-width: 600px) {
    .actions {
      flex-direction: column;
      gap: 7px;
      align-items: stretch;
      justify-content: center;
      flex-wrap: nowrap;
    }
    .actions a,
    .actions .disabled-btn {
      width: 100%;
      min-width: 0;
      box-sizing: border-box;
      text-align: center;
      font-size: 15px;
      padding: 10px 0;
    }
    td:last-child {
      min-width: 90px;
    }
  }
  footer{
    color:var(--muted);
    font-size:clamp(11px,1.8vw,14px);
    margin-top:var(--gap);
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding-top:var(--pad-footer);
    border-top:1.6px solid var(--border);
    font-family:var(--mono);
    background: transparent;
    gap: 15px;
    flex-wrap: wrap;
    word-break:break-word;
    min-height: 0;
    width: 100%;
    box-sizing: border-box;
  }
  .badge{
    padding:var(--badge-pad);
    border-radius:8px;
    background:linear-gradient(90deg,#3e2467,#4e317b 100%);
    font-size:clamp(11px,1.6vw,14px);
    color:var(--accent);
    font-family:var(--mono);
    margin-right: 12px;
    word-break: break-word;
    box-shadow: 0 1px 8px #a278ff11;
  }
  .modal{
    position:fixed;inset:0;background:var(--modal-bg);display:none;align-items:center;justify-content:center;padding:0;z-index:999;
  }
  .card{
    width:clamp(320px,96vw,900px);
    max-width:96vw;
    background:var(--card-glass);
    border-radius:14px;
    box-shadow:0 10px 40px #000a;
    overflow:hidden;
    margin:auto;
    display:flex;
    flex-direction:column;
    position:relative;
    min-height:clamp(320px,60vh,700px);
    max-height:96vh;
    border:1.5px solid #4e317b;
  }
  .card .head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:16px 20px;
    border-bottom:1px solid var(--border);
    font-family:var(--mono);
    gap: 12px;
    font-size: 17px;
    background:var(--panel);
    box-shadow: 0 2px 8px #a278ff1a;
  }
  .viewer{
    width:100%;
    height:65vh;
    min-height:180px;
    border:0;
    background:#191025;
    display:block;
    max-height:65vh;
  }
  @media (max-width:1100px){
    .wrap {padding:8vw 2vw;}
    .card{max-width:100vw;}
    .badge{margin-right: 3px;}
    table{font-size:15px;}
  }
  @media (max-width:900px){
    .wrap {padding:5vw 1vw;}
    .card{max-width:100vw;}
    .controls{gap:8px;}
    .logo{font-size:19px;}
    .title{font-size:15px;}
    input.search, select{font-size:15px;}
    .actions a, .actions .disabled-btn{font-size:14px;}
    table{font-size:13.5px;}
  }
  @media (max-width:720px){
    input.search{width:100%}
    header{flex-direction:column;align-items:flex-start;gap:10px;padding-bottom:12px;}
    .controls{margin-left:0;width:100%;gap:6px;}
    .wrap{padding:3vw 1vw;}
    .card{max-width:99vw;}
    table{font-size:12.5px;}
    thead th, td {padding: 8px 4px;}
    .badge{margin-right: 0;}
    .title{font-size:13px;}
    .actions a, .actions .disabled-btn{padding:7px 7px;}
    .logo{font-size:15px;}
    main{margin-bottom:10px;}
    .viewer{min-height:120px;}
  }
  @media (max-width:500px){
    .wrap{padding:2vw 0.5vw;}
    .badge{font-size:12px;}
    .logo{font-size:14px;}
    .title{font-size:12px;}
    .actions a, .actions .disabled-btn{font-size:12px;padding:6px 4px;}
    table{font-size:12px;}
    .card {min-height:180px;}
    .viewer{min-height:80px;}
  }
  /* Fix sticky footers/headers for body and .wrap */
  body, html {
    height: 100%;
    min-height: 100vh;
  }
  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  .wrap {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    min-height: 0;
  }
  main {
    flex: 1 1 auto;
    min-height: 0;
  }
  footer {
    flex-shrink: 0;
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Fira+Mono:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo"><span class="dot"></span> BLACKPIGEONS</div>
    <div class="controls">
      <input id="q" class="search" placeholder="Search title, author, tag..." autocomplete="off" />
      <select id="filterType" title="Filter type">
        <option value="">All types</option>
        <option value="pdf">PDF</option>
        <option value="video">Video</option>
        <option value="zip">Archive</option>
      </select>
    </div>
  </header>

  <main>
    <div style="width:100%;overflow-x:auto;">
      <table id="list">
        <thead>
          <tr>
            <th style="width:52%">Title</th>
            <th style="width:18%">Size</th>
            <th style="width:10%">Type</th>
            <th style="width:10%">Date</th>
            <th style="width:10%">Actions</th>
          </tr>
        </thead>
        <tbody id="rows">
          <!-- rows injected -->
        </tbody>
      </table>
    </div>
  </main>

  <footer>
    <div class="badge">⭐️ If you find this useful, please star this repo!</div>
    <div class="sub"></div>
  </footer>
</div>

<!-- modal viewer: PDF in card with title, open raw, close -->
<div id="modal" class="modal" role="dialog" aria-hidden="true">
  <div class="card" role="document">
    <div class="head">
      <div id="modalTitle" style="color:var(--accent);font-weight:700">Viewer</div>
      <div style="display:flex;gap:8px;align-items:center">
        <a id="rawLink" class="actions" target="_blank" rel="noopener" style="margin-right:8px;color:var(--muted);text-decoration:none">Open raw</a>
        <button id="close" class="small" style="background:none;border:1px solid var(--input-border);color:var(--muted);padding:7px 15px;border-radius:7px;cursor:pointer;font-family:var(--mono);font-size:15px;">Close</button>
      </div>
    </div>
    <div id="modalBody" style="background:var(--panel);padding:0;">
      <!-- iframe / video injected -->
    </div>
  </div>
</div>

<script>
const DATA_SRC = './files.json';

const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);
const rows = $('#rows');
const q = $('#q');
const filterType = $('#filterType');
const modal = $('#modal');
const modalBody = $('#modalBody');
const modalTitle = $('#modalTitle');
const rawLink = $('#rawLink');
const closeBtn = $('#close');

let items = [];

const sample = [
  {"id":"sample-pdf","title":"Sample Public Domain Book","author":"Various","size":"2.1 MB","type":"pdf","date":"2020-05-12","url":"https://archive.org/download/oliver_twist_0810_librivox/oliver_twist_0810.pdf","desc":"Public domain sample"},
  {"id":"sample-video","title":"Sample Lecture","author":"Nobody","size":"120 MB","type":"video","date":"2021-07-01","url":"https://archive.org/download/BigBuckBunny_328/BigBuckBunny_512kb.mp4","desc":"Demo video (public domain style)"},
  {"id":"brokenfile","title":"Broken Example File","author":"Unknown","size":"0 MB","type":"pdf","date":"2025-10-01","url":"https://archive.org/download/nonexistent.pdf","desc":"This file is broken.","status":"error"}
];

async function loadData(){
  try {
    const r = await fetch(DATA_SRC, {cache:'no-store'});
    if(!r.ok) throw new Error('no json');
    items = await r.json();
    if(!Array.isArray(items) || items.length===0) throw 'empty';
  } catch(e){
    console.warn('Could not load files.json — using sample data. Error:', e);
    items = sample;
  }
  render();
}

function render(){
  const query = (q.value || '').trim().toLowerCase();
  const typeF = filterType.value;
  const sorted = items.slice().sort((a,b)=>{
    if(a.date && b.date) return new Date(b.date) - new Date(a.date);
    return (a.title||'').localeCompare(b.title||'');
  });

  rows.innerHTML = '';
  for(const it of sorted){
    if(typeF && it.type !== typeF) continue;
    if(query){
      const hay = (it.title + ' ' + (it.author||'') + ' ' + (it.desc||'') + ' ' + (it.tags||'')).toLowerCase();
      if(!hay.includes(query)) continue;
    }
    const status = (it.status || '').toLowerCase();
    const isError = status === 'error' || status === 'incomplete';
    const titleClass = "title" + (isError ? " incomplete" : "");
    let actionsHtml;
    if(isError){
      actionsHtml = `
        <span class="disabled-btn">Download</span>
        <span class="disabled-btn">View</span>
      `;
    }else{
      actionsHtml = `
        <a href="${escapeHtml(it.url)}" target="_blank" rel="noopener">Download</a>
        <a href="#" data-id="${escapeHtml(it.id)}" class="view">View</a>
      `;
    }
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>
        <div class="${titleClass}">${escapeHtml(it.title)}</div>
        <div class="meta">${escapeHtml(it.author || '')} • <span class="tag">${escapeHtml(it.tags || it.type || '')}</span> ${escapeHtml(it.desc || '')}</div>
      </td>
      <td>${escapeHtml(it.size || '—')}</td>
      <td>${escapeHtml((it.type||'').toUpperCase())}</td>
      <td>${escapeHtml(it.date || '—')}</td>
      <td>
        <div class="actions">
          ${actionsHtml}
        </div>
      </td>
    `;
    rows.appendChild(tr);
  }

  $$('.view').forEach(a=>{
    a.addEventListener('click', e=>{
      e.preventDefault();
      const id = a.getAttribute('data-id');
      const it = items.find(x=>x.id===id);
      if(it) openViewer(it);
    });
  });
}

function openViewer(it){
  modalTitle.textContent = it.title + (it.author ? ' — ' + it.author : '');
  rawLink.href = it.url;
  rawLink.textContent = 'Open raw';
  modalBody.innerHTML = '';

  if(it.type === 'pdf'){
    const ifr = document.createElement('iframe');
    ifr.src = it.url;
    ifr.className = 'viewer';
    ifr.setAttribute('allowfullscreen','');
    modalBody.appendChild(ifr);
  } else if(it.type === 'video'){
    const v = document.createElement('video');
    v.className = 'viewer';
    v.controls = true;
    const src = document.createElement('source');
    src.src = it.url;
    src.type = 'video/mp4';
    v.appendChild(src);
    modalBody.appendChild(v);
  } else {
    modalBody.innerHTML = `<div style="padding:18px;color:var(--muted)">No inline viewer for this file type. <a href="${it.url}" target="_blank" rel="noopener">Open raw</a></div>`;
  }

  modal.style.background = "var(--modal-bg)";
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden','false');
  document.body.style.overflow = "hidden";
}

// Close modal when clicking background or Close button
closeBtn.addEventListener('click', closeModal);
modal.addEventListener('click', e => {
  if(e.target===modal) closeModal();
});
function closeModal(){
  modal.style.display = 'none';
  modalBody.innerHTML = '';
  modal.setAttribute('aria-hidden','true');
  document.body.style.overflow = "";
}

q.addEventListener('input', render);
filterType.addEventListener('change', render);

function escapeHtml(s){
  if(!s) return '';
  return String(s).replace(/[&<>"']/g, function(m){
    return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]);
  });
}

loadData();
</script>
</body>
</html>
